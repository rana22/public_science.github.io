"use strict";(self.webpackChunkICDC_Frontend=self.webpackChunkICDC_Frontend||[]).push([[4024],{4024:(t,e,r)=>{r.d(e,{makeImageData:()=>b});var o=r(92168),a=r(20212),n=r(7562);function i(t,e,r,o,a,n,i){e+o<0||e>n||(i&&(t.fillStyle=i),t.fillRect(e,r,o,a))}function s(t){const{bases:e}=t.palette;return{A:e.A.main,C:e.C.main,G:e.G.main,T:e.T.main,deletion:"#808080"}}function c(){return{charWidth:(0,n.measureText)("A"),charHeight:(0,n.measureText)("M")-2}}var l=r(20709),f=r(30880);function d({colorType:t,tag:e,feature:r,config:a,defaultColor:n,colorTagMap:i}){switch(t){case"insertSize":return function(t){return t.get("is_paired")&&t.get("refName")!==t.get("next_ref")?"#555":`hsl(${Math.abs(t.get("template_length"))/10},50%,50%)`}(r);case"strand":return function(t){return-1===t.get("strand")?"#8F8FD8":"#EC8B8B"}(r);case"mappingQuality":return function(t){return`hsl(${t.get("score")},50%,50%)`}(r);case"pairOrientation":return function(t,e){return l.pf[function(t,e){const r=(0,o.readConfObject)(e,"orientationType");return{LR:"color_pair_lr",RR:"color_pair_rr",RL:"color_pair_rl",LL:"color_pair_ll"}[f.il[r][t.get("pair_orientation")]]}(t,e)||"color_nostrand"]}(r,a);case"stranded":return function(t){return l.pf[function(t){const e=t.get("flags"),r=t.get("strand");if(1&e){const o=64&e?-1:1;return 2&e?r*o==1?"color_rev_strand":"color_fwd_strand":8&e?r*o==1?"color_rev_missing_mate":"color_fwd_missing_mate":t.get("refName")===t.get("next_ref")?r*o==1?"color_rev_strand_not_proper":"color_fwd_strand_not_proper":1===r?"color_fwd_diff_chr":"color_rev_diff_chr"}return"color_unknown"}(t)]}(r);case"xs":case"tag":{const t=r.get("tags"),o=t?t[e]:r.get(e);return"XS"===e||"TS"===e?l.pf[{"-":"color_rev_strand","+":"color_fwd_strand"}[o]||"color_nostrand"]:"ts"===e?l.pf[{"-":-1===r.get("strand")?"color_fwd_strand":"color_rev_strand","+":-1===r.get("strand")?"color_rev_strand":"color_fwd_strand"}[o]||"color_nostrand"]:i[o]||l.pf.color_nostrand}case"insertSizeAndPairOrientation":break;case"modifications":case"methylation":return 16&r.get("flags")?"#c8dcc8":"#c8c8c8";default:return n?"lightgrey":(0,o.readConfObject)(a,"color",{feature:r})}}var h=r(88476),g=r(18973);function p({ctx:t,feat:e,renderArgs:r,colorForBase:o,contrastForBase:a,charWidth:s,charHeight:c,defaultColor:l,canvasWidth:p}){const{config:u,bpPerPx:x,regions:b,colorBy:m,colorTagMap:P={}}=r,{tag:_="",type:S=""}=m||{},{feature:v}=e,y=b[0];switch(t.fillStyle=d({feature:v,config:u,tag:_,defaultColor:l,colorType:S,colorTagMap:P}),function({ctx:t,feat:e,renderArgs:r}){const{regions:o,bpPerPx:a}=r,{heightPx:i,topPx:s,feature:c}=e,[l]=o,f=c.get("start"),d=c.get("end"),[h,g]=(0,n.bpSpanPx)(f,d,l,a),p=l.reversed?-1:1,u=c.get("strand")*p;a<10&&i>5?-1===u?(t.beginPath(),t.moveTo(h-5,s+i/2),t.lineTo(h,s+i),t.lineTo(g,s+i),t.lineTo(g,s),t.lineTo(h,s),t.closePath(),t.fill()):(t.beginPath(),t.moveTo(h,s),t.lineTo(h,s+i),t.lineTo(g,s+i),t.lineTo(g+5,s+i/2),t.lineTo(g,s),t.closePath(),t.fill()):t.fillRect(h,s,g-h,i)}({ctx:t,feat:e,renderArgs:r}),S){case"perBaseQuality":!function({ctx:t,feat:e,region:r,bpPerPx:o,canvasWidth:a}){const{feature:s,topPx:c,heightPx:l}=e,f=(s.get("qual")||"").split(" ").map((t=>+t)),d=(0,h.eL)(s.get("CIGAR")),g=1/o,p=s.get("start");let u=0,x=0;for(let e=0;e<d.length;e+=2){const s=+d[e],h=d[e+1];if("S"===h||"I"===h)u+=s;else if("D"===h||"N"===h)x+=s;else if("M"===h||"X"===h||"="===h){for(let e=0;e<s;e++){const s=f[u+e],d=p+x+e;i(t,(0,n.bpSpanPx)(d,d+1,r,o)[0],c,g+.5,l,a,`hsl(${255===s?150:1.5*s},55%,50%)`)}u+=s,x+=s}}}({ctx:t,feat:e,region:y,bpPerPx:x,canvasWidth:p});break;case"perBaseLettering":!function({ctx:t,feat:e,region:r,bpPerPx:o,colorForBase:a,contrastForBase:s,charWidth:c,charHeight:l,canvasWidth:f}){const d=l-2,{feature:g,topPx:p,heightPx:u}=e,x=g.get("seq"),b=(0,h.eL)(g.get("CIGAR")),m=1/o,P=g.get("start");let _=0,S=0;if(x)for(let e=0;e<b.length;e+=2){const l=+b[e],h=b[e+1];if("S"===h||"I"===h)_+=l;else if("D"===h||"N"===h)S+=l;else if("M"===h||"X"===h||"="===h){for(let e=0;e<l;e++){const l=x[_+e],h=P+S+e,[g]=(0,n.bpSpanPx)(h,h+1,r,o);i(t,g,p,m+.5,u,f,a[l]),m>=c&&u>=d&&(t.fillStyle=s[l],t.fillText(l,g+(m-c)/2+1,p+u))}_+=l,S+=l}}}({ctx:t,feat:e,region:y,bpPerPx:x,colorForBase:o,contrastForBase:a,charWidth:s,charHeight:c,canvasWidth:p});break;case"modifications":!function({ctx:t,feat:e,region:r,bpPerPx:o,renderArgs:a,canvasWidth:s}){const{feature:c,topPx:l,heightPx:d}=e,{modificationTagMap:p={}}=a,u=c.get("seq");if(!u)return;const x=(0,f.c$)(c,"MM","Mm")||"",b=c.get("CIGAR"),m=c.get("start"),P=c.get("strand"),_=(0,h.eL)(b),S=(0,h.wg)(c),v=(0,h.xA)(x,u,P);let y=0;for(const{type:e,positions:a}of v){const c=p[e]||"black",f=(0,g.colord)(c);for(const e of(0,h.hn)(_,a)){const a=m+e,[h,g]=(0,n.bpSpanPx)(a,a+1,r,o),p=(null==S?void 0:S[y])||0;i(t,h,l,g-h+.5,d,s,1!==p?f.alpha(p+.1).toHslString():c),y++}}}({ctx:t,feat:e,region:y,bpPerPx:x,renderArgs:r,canvasWidth:p});break;case"methylation":!function({ctx:t,feat:e,region:r,bpPerPx:o,renderArgs:a,canvasWidth:s}){var c,l;const{regionSequence:f}=a,{feature:d,topPx:p,heightPx:u}=e;if(!f)throw new Error("region sequence required for methylation");if(!d.get("seq"))return;const x=d.get("start"),b=d.get("end"),{methBins:m,methProbs:P}=(0,h.Ps)(d);function _(t){if(m[t]){const e=P[t]||0;return(e>.5?(0,g.colord)("red").alpha(2*(e-.5)):(0,g.colord)("blue").alpha(1-2*e)).toHslString()}}for(let e=0;e<b-x;e++){const a=e+x,d=null===(c=f[a-r.start+1])||void 0===c?void 0:c.toLowerCase(),h=null===(l=f[a-r.start+2])||void 0===l?void 0:l.toLowerCase();if("c"===d&&"g"===h)if(o>2){const[c,l]=(0,n.bpSpanPx)(a,a+2,r,o);i(t,c,p,l-c+.5,u,s,_(e)||_(e+1)||"blue")}else{const[c,l]=(0,n.bpSpanPx)(a,a+1,r,o);i(t,c,p,l-c+.5,u,s,_(e)||"blue");const[f,d]=(0,n.bpSpanPx)(a+1,a+2,r,o);i(t,f,p,d-f+.5,u,s,_(e+1)||"blue")}}}({ctx:t,feat:e,region:y,bpPerPx:x,renderArgs:r,canvasWidth:p})}}function u({ctx:t,feat:e,renderArgs:r,minSubfeatureWidth:o,largeInsertionIndicatorScale:a,mismatchAlpha:s,charWidth:c,charHeight:l,colorForBase:f,contrastForBase:d,canvasWidth:h,drawSNPsMuted:p,drawIndels:u=!0}){const{bpPerPx:x,regions:b}=r,{heightPx:m,topPx:P,feature:_}=e,[S]=b,v=_.get("start"),y=Math.min(1/x,2),T=_.get("mismatches"),C=l-2,W=S.reversed?1/x+1:-1;if(T){for(const e of T){const r=v+e.start,a=e.length,l=e.base,[b,_]=(0,n.bpSpanPx)(r,r+a,S,x),T=Math.max(o,Math.abs(b-_));if("mismatch"===e.type){if(!p){const r=f[e.base]||"#888",o=s?void 0===e.qual?r:(0,g.colord)(r).alpha(Math.min(1,e.qual/50)).toHslString():r;i(t,Math.round(b),P,T,m,h,o)}if(T>=c&&m>=C){const r=p?"black":d[e.base]||"black";t.fillStyle=s?void 0===e.qual?r:(0,g.colord)(r).alpha(Math.min(1,e.qual/50)).toHslString():r,t.fillText(l,b+(T-c)/2+1,P+m)}}else if("deletion"===e.type&&u){i(t,b,P,Math.abs(b-_),m,h,f.deletion);const r=`${e.length}`,o=(0,n.measureText)(r,10);T>=o&&m>=C&&(t.fillStyle=d.deletion,t.fillText(r,(b+_)/2-o/2,P+m))}else if("insertion"===e.type&&u){t.fillStyle="purple";const r=b+W,o=+e.base||e.length,a=Math.max(0,Math.min(1.2,1/x));if(o<10&&(i(t,r,P,a,m,h,"purple"),1/x>=c&&m>=C)){const o=r-a;i(t,o,P,3*a,1,h),i(t,o,P+m-1,3*a,1,h),t.fillText(`(${e.base})`,r+3,P+m)}}else if("hardclip"===e.type||"softclip"===e.type){const r=b+W,a="hardclip"===e.type?"red":"blue",n=Math.max(o,y);if(i(t,r,P,n,m,h,a),1/x>=c&&m>=C){const o=r-n;i(t,o,P,3*n,1,h),i(t,o,P+m-1,3*n,1,h),t.fillText(`(${e.base})`,r+3,P+m)}}else if("skip"===e.type&&b+T>0){const e=T-(x>10?1.5:0);t.clearRect(b,P,e,m),i(t,Math.max(0,b),P+m/2-1,e+(b<0?b:0),2,h,"#333")}}if(u)for(const e of T){const r=v+e.start,o=e.length,[s]=(0,n.bpSpanPx)(r,r+o,S,x),c=+e.base||e.length,f=`${c}`;if("insertion"===e.type&&c>=10)if(x>a)i(t,s-1,P,2,m,h,"purple");else if(m>l){const e=(0,n.measureText)(f),r=5;i(t,s-e/2-r,P,e+2*r,m,h,"purple"),t.fillStyle="white",t.fillText(f,s-e/2,P+m)}else{const e=2;i(t,s-e,P,2*e,m,h,"purple")}}}}function x({ctx:t,feat:e,renderArgs:r,config:a,theme:s,colorForBase:l,canvasWidth:f}){const{feature:d,topPx:h,heightPx:g}=e,{regions:p,bpPerPx:u}=r,[x]=p,b=(0,o.readConfObject)(a,"minSubfeatureWidth"),m=d.get("mismatches"),P=d.get("seq"),{charWidth:_,charHeight:S}=c();if(!P||!m)return;const v=S-2;for(const e of m)if("softclip"===e.type){const r=e.cliplen||0,o=d.get("start"),a=0===e.start?o-r:o+e.start;for(let o=0;o<r;o+=1){const r=P.charAt(o+e.start);if(!r)return;const c=a+o,[d,p]=(0,n.bpSpanPx)(c,c+1,x,u),m=Math.max(b,p-d),S=l[r]||"#000000";t.fillStyle=S,i(t,d,h,m,g,f),m>=_&&g>=v&&(t.fillStyle=s.palette.getContrastText(S),t.fillText(r,d+(m-_)/2+1,h+g))}}}function b({ctx:t,layoutRecords:e,canvasWidth:r,renderArgs:n}){const{config:i,showSoftClip:l,colorBy:f,theme:d}=n,h=(0,o.readConfObject)(i,"mismatchAlpha"),g=(0,o.readConfObject)(i,"minSubfeatureWidth"),b=(0,o.readConfObject)(i,"largeInsertionIndicatorScale"),m="#f0f"===(0,o.readConfObject)(i,"color"),P=(0,a.createJBrowseTheme)(d),_=s(P),S=function(t){return Object.fromEntries(Object.entries(s(t)).map((([e,r])=>[e,t.palette.getContrastText(r)])))}(P);t.font="bold 10px Courier New,monospace";const{charWidth:v,charHeight:y}=c(),T=(C=null==f?void 0:f.type,["methylation","modifications"].includes(C||""));var C;for(const o of e)p({ctx:t,feat:o,renderArgs:n,defaultColor:m,colorForBase:_,contrastForBase:S,charWidth:v,charHeight:y,canvasWidth:r}),u({ctx:t,feat:o,renderArgs:n,mismatchAlpha:h,drawSNPsMuted:T,drawIndels:!0,largeInsertionIndicatorScale:b,minSubfeatureWidth:g,charWidth:v,charHeight:y,colorForBase:_,contrastForBase:S,canvasWidth:r}),l&&x({ctx:t,feat:o,renderArgs:n,colorForBase:_,config:i,theme:P,canvasWidth:r})}}}]);