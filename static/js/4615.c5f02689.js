"use strict";(self.webpackChunkICDC_Frontend=self.webpackChunkICDC_Frontend||[]).push([[4615],{4615:(e,t,l)=>{l.r(t),l.d(t,{default:()=>V});var n=l(96540),a=l(30799),o=l(20212),r=l(44015),i=l(27813),c=l(50346),s=l(60801),d=l(91089),m=l(6096),u=l.n(m),h=l(73085),f=l.n(h),p=l(7562),w=l(23750),v=l(44877),E=l(99020),g=l(1043),k=l(29153),C=l(19455),b=l(12092),S=l(1795),A=l(65897);function y({model:e}){const{faceted:t}=e,[l,a]=(0,n.useState)(null),{showOptions:r,showFilters:i,showSparse:c,useShoppingCart:s}=t;return n.createElement(n.Fragment,null,n.createElement(E.Ay,{container:!0,spacing:4,alignItems:"center"},n.createElement(E.Ay,{item:!0},n.createElement(g.A,{label:"Search...",value:t.filterText,onChange:e=>t.setFilterText(e.target.value),InputProps:{endAdornment:n.createElement(k.A,{position:"end"},n.createElement(C.A,{onClick:()=>t.setFilterText("")},n.createElement(b.A,null)))}})),n.createElement(E.Ay,{item:!0},n.createElement(C.A,{onClick:e=>a(e.currentTarget)},n.createElement(S.A,null))),n.createElement(E.Ay,{item:!0},n.createElement(A.A,{model:e}))),n.createElement(o.Menu,{anchorEl:l,open:!!l,onClose:()=>a(null),onMenuItemClick:(e,t)=>{t(),a(null)},menuItems:[{label:"Add tracks to selection instead of turning them on/off",onClick:()=>t.setUseShoppingCart(!s),type:"checkbox",checked:s},{label:"Show sparse metadata columns",onClick:()=>t.setShowSparse(!c),checked:c,type:"checkbox"},{label:"Show facet filters",onClick:()=>t.setShowFilters(!i),checked:i,type:"checkbox"},{label:"Show extra table options",onClick:()=>t.setShowOptions(!r),checked:r,type:"checkbox"}]}))}var x=l(56655),F=l(45359),M=l(33551),T=l(70057),I=l(95825),O=l(16718);const H=(0,v.makeStyles)()((e=>({facet:{margin:0,marginLeft:e.spacing(2)},select:{marginBottom:e.spacing(2)}})));function N({onClick:e}){return n.createElement(x.A,{title:"Clear selection on this facet filter"},n.createElement(C.A,{onClick:()=>e(),size:"small"},n.createElement(b.A,null)))}function z({visible:e,onClick:t}){return n.createElement(x.A,{title:"Minimize/expand this facet filter"},n.createElement(C.A,{onClick:()=>t(),size:"small"},e?n.createElement(I.A,null):n.createElement(O.A,null)))}const R=(0,r.observer)((function({column:e,vals:t,model:l}){const{classes:a}=H(),[o,r]=(0,n.useState)(!0),{faceted:i}=l,{filters:c}=i,{field:s}=e;return n.createElement(F.A,{className:a.facet,fullWidth:!0},n.createElement("div",null,n.createElement(M.A,{component:"span"},s),n.createElement(N,{onClick:()=>i.setFilter(s,[])}),n.createElement(z,{visible:o,onClick:()=>r(!o)})),o?n.createElement(T.A,{multiple:!0,native:!0,className:a.select,value:c.get(e.field)||[],onChange:t=>{i.setFilter(e.field,[...t.target.options].filter((e=>e.selected)).map((e=>e.value)))}},t.sort(((e,t)=>e[0].localeCompare(t[0]))).map((([e,t])=>n.createElement("option",{key:e,value:e},(0,p.coarseStripHTML)(e)," (",t,")")))):null)}));var W=l(16912);const D=(0,r.observer)((function({rows:e,columns:t,model:l}){var a,o;const{faceted:r}=l,{filters:i}=r,c=t.slice(1),s=new Map(c.map((e=>[e.field,new Map]))),d=r.filters.keys(),m=c.map((e=>e.field)),u=new Set;for(const e of d)(null===(a=i.get(e))||void 0===a?void 0:a.length)&&u.add(e);for(const e of m)u.add(e);let h=e;for(const e of u){const t=s.get(e);for(const l of h){const n=(0,W.a)(e,l),a=t.get(n);n&&(void 0===a?t.set(n,1):t.set(n,a+1))}const l=(null===(o=i.get(e))||void 0===o?void 0:o.length)?new Set(i.get(e)):void 0;h=h.filter((t=>void 0===l||l.has((0,W.a)(e,t))))}return n.createElement("div",null,c.map((e=>n.createElement(R,{key:e.field,vals:[...s.get(e.field)],column:e,model:l}))))}));var L=l(8810);const j=(0,v.makeStyles)()({cell:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},resizeHandle:{marginLeft:5,background:"grey",width:5}}),B=.75,P=(0,r.observer)((function({model:e}){var t;const{classes:l}=j(),{view:a,selection:r,shownTrackIds:m,faceted:h}=e,{rows:v,panelWidth:E,showFilters:g,useShoppingCart:k,showOptions:C,filteredRows:b,filteredNonMetadataKeys:S,filteredMetadataKeys:A,visible:x,widths:F}=h,{pluginManager:M}=(0,p.getEnv)(e),{ref:T,scrollLeft:I}=(0,w.useResizeBar)(),O=(0,p.useDebounce)(F,200),H=[{field:"name",hideable:!1,renderCell:t=>{const{value:a,row:o}=t,{id:r,conf:i}=o;return n.createElement("div",{className:l.cell},n.createElement(u(),{html:a}),n.createElement(L.A,{id:r,conf:i,trackId:r,model:e}))},width:null!==(t=O.name)&&void 0!==t?t:100},...S.map((e=>{var t;return{field:e,width:null!==(t=O[e])&&void 0!==t?t:100,renderCell:e=>{const t=e.value;return t?n.createElement(u(),{className:l.cell,html:t}):""}}})),...A.map((e=>{var t;return{field:`metadata.${e}`,headerName:["name",...S].includes(e)?`${e} (from metadata)`:e,width:null!==(t=O["metadata."+e])&&void 0!==t?t:100,valueGetter:(t,l)=>`${l.metadata[e]}`,renderCell:e=>{const t=e.value;return t?n.createElement(u(),{className:l.cell,html:t}):""}}}))];return n.createElement(n.Fragment,null,n.createElement(y,{model:e}),n.createElement("div",{ref:T,style:{display:"flex",overflow:"hidden",height:window.innerHeight*B,width:window.innerWidth*B}},n.createElement("div",{style:{height:window.innerHeight*B,width:window.innerWidth*B-(g?E:0)}},n.createElement(f(),{checkbox:!0,widths:Object.values(F).map((e=>null!=e?e:100)),setWidths:e=>h.setWidths(Object.fromEntries(Object.entries(F).map(((t,l)=>[t[0],e[l]])))),scrollLeft:I}),n.createElement(s.z,{rows:b,columnVisibilityModel:x,onColumnVisibilityModelChange:e=>h.setVisible(e),columnHeaderHeight:35,checkboxSelection:!0,disableRowSelectionOnClick:!0,keepNonExistentRowsSelected:!0,onRowSelectionModelChange:t=>{if(k){const l=(0,c.getRoot)(e),n=M.pluggableConfigSchemaType("track");e.setSelection(t.map((e=>(0,c.resolveIdentifier)(n,l,e))))}else{const l=m,n=new Set(t);(0,i.transaction)((()=>{[...l].filter((e=>!n.has(e))).map((e=>a.hideTrack(e))),[...n].filter((e=>!l.has(e))).map((t=>{a.showTrack(t),e.addToRecentlyUsed(t)}))}))}},rowSelectionModel:k?r.map((e=>e.trackId)):[...m],slots:{toolbar:C?d.O:null},slotProps:{toolbar:{printOptions:{disableToolbarButton:!0}}},columns:H,rowHeight:25})),g?n.createElement(n.Fragment,null,n.createElement(o.ResizeHandle,{vertical:!0,onDrag:e=>h.setPanelWidth(E-e),className:l.resizeHandle}),n.createElement("div",{style:{width:E,overflow:"auto"}},n.createElement(D,{model:e,rows:v,columns:H}))):null))})),V=(0,r.observer)((function(e){const{handleClose:t}=e;return n.createElement(o.Dialog,{open:!0,onClose:t,maxWidth:"xl",title:"Faceted track selector"},n.createElement(a.A,null,n.createElement(P,{...e})))}))}}]);