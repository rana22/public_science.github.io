"use strict";(self.webpackChunkICDC_Frontend=self.webpackChunkICDC_Frontend||[]).push([[5290],{65290:(t,e,r)=>{r.r(e),r.d(e,{default:()=>h});var a=r(29008),s=r(2340),n=r(11375),o=r(34105),i=r(31056),c=r(26018),l=r(20459);class u extends s.BaseFeatureDataAdapter{constructor(){super(...arguments),this.intervalTrees={}}async loadDataP(t={}){const e=this.pluginManager,r=this.getConf("bedLocation"),s=await(0,n.openLocation)(r,e).readFile(t),o=function(t){return 31===t[0]&&139===t[1]&&8===t[2]}(s)?await(0,c.unzip)(s):s;if(o.length>536870888)throw new Error("Data exceeds maximum string length (512MB)");const i=new TextDecoder("utf8",{fatal:!0}).decode(o).split(/\n|\r\n|\r/).filter((t=>!!t)),l=[];let u=0;for(;u<i.length&&i[u].startsWith("#");u++)l.push(i[u]);const h=l.join("\n"),d={};for(;u<i.length;u++){const t=i[u],e=t.indexOf("\t"),r=t.slice(0,e);d[r]||(d[r]=[]),d[r].push(t)}const f=this.getConf("autoSql");return{header:h,features:d,parser:new a.default({autoSql:f}),columnNames:this.getConf("columnNames"),scoreColumn:this.getConf("scoreColumn"),colRef:this.getConf("colRef"),colStart:this.getConf("colStart"),colEnd:this.getConf("colEnd")}}async loadData(t={}){return this.bedFeatures||(this.bedFeatures=this.loadDataP(t).catch((t=>{throw this.bedFeatures=void 0,t}))),this.bedFeatures}async getRefNames(t={}){const{features:e}=await this.loadData(t);return Object.keys(e)}async getHeader(t={}){const{header:e}=await this.loadData(t);return e}async getNames(){const{header:t,columnNames:e}=await this.loadData();if(e.length)return e;const r=t.split(/\n|\r\n|\r/).filter((t=>!!t)).at(-1);return(null==r?void 0:r.includes("\t"))?r.slice(1).split("\t").map((t=>t.trim())):void 0}async loadFeatureIntervalTreeHelper(t){const{colRef:e,colStart:r,colEnd:a,features:s,parser:n,scoreColumn:o}=await this.loadData(),c=s[t];if(!c)return;const u=await this.getNames(),h=new i.Ay,d=c.map(((s,i)=>{const c=`${this.id}-${t}-${i}`;return(0,l.dE)(s,e,r,a,o,n,c,u)}));for(const t of d)h.insert([t.get("start"),t.get("end")],t);return h}async loadFeatureIntervalTree(t){return this.intervalTrees[t]||(this.intervalTrees[t]=this.loadFeatureIntervalTreeHelper(t).catch((e=>{throw this.intervalTrees[t]=void 0,e}))),this.intervalTrees[t]}getFeatures(t,e={}){return(0,o.ObservableCreate)((async e=>{const{start:r,end:a,refName:s}=t,n=await this.loadFeatureIntervalTree(s);null==n||n.search([r,a]).forEach((t=>e.next(t))),e.complete()}),e.signal)}freeResources(){}}u.capabilities=["getFeatures","getRefNames"];const h=u},20459:(t,e,r)=>{r.d(e,{BX:()=>s,dE:()=>o,xD:()=>i,zZ:()=>n});var a=r(7562);function s(t){var e;const{subfeatures:r,thickStart:a,thickEnd:s,blockCount:n,blockSizes:o,chromStarts:i,refName:c,strand:l=0,...u}=t;if(!a||!s||!l)return t;const h=[];return null===(e=r.filter((t=>"block"===t.type)).sort(((t,e)=>t.start-e.start)))||void 0===e||e.forEach((t=>{const e=t.start,r=t.end;if(a>=r){const t=l>0?"five":"three";h.push({type:`${t}_prime_UTR`,start:e,end:r,refName:c})}else if(a>e&&a<r&&s>=r){const t=l>0?"five":"three";h.push({type:`${t}_prime_UTR`,start:e,end:a,refName:c},{type:"CDS",start:a,end:r,refName:c})}else if(a<=e&&s>=r)h.push({type:"CDS",start:e,end:r,refName:c});else if(a>e&&a<r&&s<r){const t=l>0?"five":"three",n=l>0?"three":"five";h.push({type:`${t}_prime_UTR`,start:e,end:a,refName:c},{type:"CDS",start:a,end:s,refName:c},{type:`${n}_prime_UTR`,start:s,end:r,refName:c})}else if(a<=e&&s>e&&s<r){const t=l>0?"three":"five";h.push({type:"CDS",start:e,end:s,refName:c},{type:`${t}_prime_UTR`,start:s,end:r,refName:c})}else if(s<=e){const t=l>0?"three":"five";h.push({type:`${t}_prime_UTR`,start:e,end:r,refName:c})}})),{...u,strand:l,type:"mRNA",refName:c,subfeatures:h}}function n({start:t,uniqueId:e,refName:r,chromStarts:a,blockCount:s,blockSizes:n,blockStarts:o}){const i=[],c=a||o||[];for(let a=0;a<s;a++){const s=(c[a]||0)+t,o=s+((null==n?void 0:n[a])||0);i.push({uniqueId:`${e}-${a}`,start:s,end:o,refName:r,type:"block"})}return i}function o(t,e,r,o,c,l,u,h){const d=t.split("\t"),f=d[e],m=+d[r],p=r===o?1:0,k=+d[o]+p,b=h?function(t,e){const{blockStarts:r,blockCount:a,chromStarts:s,thickEnd:n,thickStart:o,blockSizes:i,...c}=Object.fromEntries(e.split("\t").map(((e,r)=>[t[r],e])));return{...c,blockStarts:null==r?void 0:r.split(",").map((t=>+t)),chromStarts:null==s?void 0:s.split(",").map((t=>+t)),blockSizes:null==i?void 0:i.split(",").map((t=>+t)),thickStart:+o,thickEnd:+n,blockCount:+a}}(h,t):l.parseLine(t,{uniqueId:u}),{blockCount:S,blockSizes:C,blockStarts:v,chromStarts:g,thickStart:y,thickEnd:N,type:w,score:D,chrom:T,chromStart:E,chromEnd:F,..._}=b,R=S?n({start:m,uniqueId:u,refName:f,chromStarts:g,blockCount:S,blockSizes:C,blockStarts:v}):[],I={..._,type:w,score:c?+b[c]:D,start:m,end:k,refName:f,uniqueId:u,subfeatures:R};return new a.SimpleFeature({id:u,data:i(b)?s({thickStart:y,thickEnd:N,blockCount:S,blockSizes:C,chromStarts:g,...I}):I})}function i(t){return t.thickStart&&t.blockCount&&0!==t.strand}}}]);