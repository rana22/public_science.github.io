"use strict";(self.webpackChunkICDC_Frontend=self.webpackChunkICDC_Frontend||[]).push([[2406],{22406:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ee});var n=a(96540),r=a(44015),l=a(45359),s=a(70057),c=a(17681),o=a(80607),i=a(7562),d=a(33551),m=a(47431),p=a(31325),u=a(75351),g=a(45119),k=a(51629),f=a(44659),E=a(44877),h=a(50346),y=a(92168),A=a(90656),v=a(1043),b=a(1775),S=a(71238),N=a(92024),T=a(20212),x=a(34339),w=a(13945),C=a(4785),D=a(56239),I=a(27465),M=a(3959),P=a(29153),W=a(19455),O=a(67034),B=a(16718);const F=(0,E.makeStyles)()((e=>({paper:{display:"flex",flexDirection:"column",padding:e.spacing(1)},card:{marginTop:e.spacing(1)}}))),j=(0,r.observer)((function({model:e}){const{classes:t}=F(),[a,r]=(0,n.useState)(""),[l,s]=(0,n.useState)(""),[c,o]=(0,n.useState)(["Name","ID"]),[i,d]=(0,n.useState)(["CDS","exon"]),m=[{label:"Indexing attributes",values:c},{label:"Feature types to exclude",values:i}];return(0,n.useEffect)((()=>{e.setTextIndexingConf({attributes:c,exclude:i})}),[e,c,i]),n.createElement(x.A,{className:t.paper},n.createElement(w.A,null,"Indexing configuration"),m.map(((e,m)=>n.createElement(C.A,{raised:!0,key:e.label,className:t.card},n.createElement(D.A,null,n.createElement(w.A,null,e.label),n.createElement(I.A,{disablePadding:!0},e.values.map(((t,a)=>n.createElement(M.Ay,{key:a,disableGutters:!0},n.createElement(v.A,{value:t,InputProps:{endAdornment:n.createElement(P.A,{position:"end"},n.createElement(W.A,{onClick:()=>{const t=e.values.filter(((e,t)=>t!==a));0===m?o(t):d(t)}},n.createElement(O.A,null)))}})))),n.createElement(M.Ay,{disableGutters:!0},n.createElement(v.A,{value:0===m?a:l,placeholder:"add new",onChange:e=>{0===m?r(e.target.value):s(e.target.value)},InputProps:{endAdornment:n.createElement(P.A,{position:"end"},n.createElement(W.A,{onClick:()=>{0===m?(o([...c,a]),r("")):(d([...i,l]),s(""))},disabled:0===m?""===a:""===l,"data-testid":"stringArrayAdd-Feat"},n.createElement(B.A,null)))}}))))))))})),U=(0,E.makeStyles)()((e=>({spacing:{marginBottom:e.spacing(3)}}))),J=(0,r.observer)((({model:e})=>{const{classes:t}=U(),{pluginManager:a}=(0,i.getEnv)(e),{trackType:r}=e,l=a.getTrackElements();return n.createElement(v.A,{className:t.spacing,value:r,variant:"outlined",label:"Track type",helperText:"Select track type",select:!0,fullWidth:!0,onChange:t=>e.setTrackType(t.target.value),SelectProps:{SelectDisplayProps:{"data-testid":"trackTypeSelect"}}},l.map((({name:e,displayName:t})=>n.createElement(c.A,{key:e,value:e},t))))}));var G=a(68463);const _=(0,E.makeStyles)()((e=>({spacing:{marginBottom:e.spacing(3)}}))),R=(0,r.observer)((({model:e})=>{const{classes:t}=_(),{trackAdapter:a}=e,{pluginManager:r}=(0,i.getEnv)(e);return n.createElement(v.A,{className:t.spacing,value:"UNKNOWN"!==(null==a?void 0:a.type)?null==a?void 0:a.type:"",label:"Adapter type",variant:"outlined",helperText:"Select an adapter type",select:!0,fullWidth:!0,onChange:t=>e.setAdapterHint(t.target.value),SelectProps:{SelectDisplayProps:{"data-testid":"adapterTypeSelect"}}},Object.entries(function(e){const t={};return e.forEach((e=>{var a;const n=(null===(a=e.adapterMetadata)||void 0===a?void 0:a.category)||"Default";t[n]||(t[n]=[]),t[n].push(e)})),t}(r.getAdapterElements().filter((e=>{var t;return!(null===(t=e.adapterMetadata)||void 0===t?void 0:t.hiddenFromGUI)})))).map((([e,t])=>[n.createElement(G.A,{key:e},e),t.map((e=>n.createElement(c.A,{key:e.name,value:e.name},e.displayName)))])))})),q=(0,E.makeStyles)()((e=>({spacing:{marginBottom:e.spacing(3)}})));function H({trackAdapter:e,trackType:t}){const{classes:a}=q(),{type:r,subadapter:l}=e;return"SNPCoverageAdapter"===r?n.createElement(d.A,{className:a.spacing},"Selected ",n.createElement("code",null,t),". Using adapter ",n.createElement("code",null,r)," with subadapter ",n.createElement("code",null,null==l?void 0:l.type),". Please enter a track name and, if necessary, update the track type."):n.createElement(d.A,{className:a.spacing},"Using adapter ",n.createElement("code",null,r)," and guessing track type"," ",n.createElement("code",null,t),". Please enter a track name and, if necessary, update the track type.")}function L({model:e}){const{classes:t}=q();return n.createElement(n.Fragment,null,n.createElement(d.A,{className:t.spacing},"JBrowse was not able to guess the adapter type for this data, but it may be in the list below. If not, you can"," ",n.createElement(A.A,{href:"https://github.com/GMOD/jbrowse-components/releases",target:"_blank",rel:"noopener noreferrer"},"check for new releases")," ","of JBrowse to see if they support this data type or"," ",n.createElement(A.A,{href:"https://github.com/GMOD/jbrowse-components/issues/new",target:"_blank",rel:"noopener noreferrer"},"file an issue")," ","and add a feature request for this data type."),n.createElement(R,{model:e}))}const $=(0,r.observer)((function({model:e}){const{classes:t}=q(),[a,r]=(0,n.useState)(!0),s=(0,i.getSession)(e),{trackName:c,trackAdapter:o,trackType:m,warningMessage:p,adapterHint:u}=e;if((0,n.useEffect)((()=>{""===u&&o&&e.setAdapterHint(o.type)}),[u,o,null==o?void 0:o.type,e]),e.unsupported)return n.createElement(d.A,{className:t.spacing},"This version of JBrowse cannot display data of this type. It is possible, however, that there is a newer version that can display them. You can"," ",n.createElement(A.A,{href:"https://github.com/GMOD/jbrowse-components/releases",target:"_blank",rel:"noopener noreferrer"},"check for new releases")," ","of JBrowse or"," ",n.createElement(A.A,{href:"https://github.com/GMOD/jbrowse-components/issues/new",target:"_blank",rel:"noopener noreferrer"},"file an issue")," ","and add a feature request for this data type.");if((null==o?void 0:o.type)===N.UNKNOWN)return n.createElement(L,{model:e});if(!(null==o?void 0:o.type))return n.createElement(d.A,null,"Could not recognize this data type.");const g=(0,i.isSupportedIndexingAdapter)(null==o?void 0:o.type);return n.createElement("div",null,o?n.createElement(H,{trackAdapter:o,trackType:m}):null,p?n.createElement(d.A,{style:{color:"orange"}},p):null,n.createElement(v.A,{className:t.spacing,label:"trackName",helperText:"A name for this track",fullWidth:!0,value:c,onChange:t=>e.setTrackName(t.target.value),inputProps:{"data-testid":"trackNameInput"}}),n.createElement(R,{model:e}),n.createElement(J,{model:e}),n.createElement(T.AssemblySelector,{session:s,helperText:"Select assembly to add track to",selected:e.assembly,onChange:t=>e.setAssembly(t),TextFieldProps:{fullWidth:!0,SelectProps:{SelectDisplayProps:{"data-testid":"assemblyNameSelect"}}}}),i.isElectron&&g&&n.createElement(l.A,null,n.createElement(b.A,{label:"Index track for text searching?",control:n.createElement(S.A,{checked:a,onChange:t=>{r(t.target.checked),e.setTextIndexTrack(t.target.checked)}})})),i.isElectron&&a&&g?n.createElement(j,{model:e}):null)})),z=(0,E.makeStyles)()((e=>({paper:{padding:e.spacing(2)},spacer:{height:e.spacing(8)}}))),K=(0,r.observer)((function({model:e}){const{classes:t}=z(),a=(0,h.getRoot)(e);return n.createElement(x.A,{className:t.paper},n.createElement(T.FileSelector,{name:"Main file",description:"",location:e.trackData,setLocation:e.setTrackData,setName:e.setTrackName,rootModel:a}),n.createElement("div",{className:t.spacer}),n.createElement(T.FileSelector,{name:"Index file",description:"(Optional) The URL of the index file is automatically inferred from the URL of the main file if it is not supplied.",location:e.indexTrackData,setLocation:e.setIndexTrackData,setName:e.setTrackName,rootModel:a}))})),V=(0,E.makeStyles)()((e=>({root:{marginTop:e.spacing(1)},stepper:{backgroundColor:e.palette.background.default},button:{marginRight:e.spacing(1)},actionsContainer:{marginTop:e.spacing(10),marginBottom:e.spacing(2)},alertContainer:{padding:`${e.spacing(2)}px 0px ${e.spacing(2)}px 0px`}}))),Y=["Enter track data","Confirm track type"],Q=(0,r.observer)((function({model:e}){const[t,a]=(0,n.useState)(0),{classes:r}=V(),{jobsManager:l}=(0,h.getRoot)(e),s=(0,i.getSession)(e),{assembly:c,trackAdapter:o,trackData:E,trackName:A,trackType:v,textIndexTrack:b,textIndexingConf:S}=e,[N,T]=(0,n.useState)();async function x(){var n,r;if(t!==Y.length-1)return void a(t+1);const d=[`${A.toLowerCase().replaceAll(" ","_")}-${Date.now()}`,s.adminMode?"":"-sessionTrack"].join(""),m=s.assemblyManager.get(c);if((0,i.isSessionWithAddTracks)(s))if(m&&o&&"UNKNOWN"!==o.type){if(s.addTrackConf({trackId:d,type:v,name:A,assemblyNames:[c],adapter:{...o,sequenceAdapter:(0,y.getConf)(m,["sequence","adapter"])}}),null===(r=(n=e.view).showTrack)||void 0===r||r.call(n,d),i.isElectron&&b&&(0,i.isSupportedIndexingAdapter)(o.type)){const e=A+"-index",t={indexingParams:{...S||{attributes:["Name","ID"],exclude:["CDS","exon"]},assemblies:[c],tracks:[d],indexType:"perTrack",name:e,timestamp:(new Date).toISOString()},name:e,cancelCallback:()=>l.abortJob()};l.queueJob(t)}e.clearData(),(0,i.isSessionModelWithWidgets)(s)&&s.hideWidget(e)}else T("Failed to add track.\nThe configuration of this file is not currently supported.");else T("Unable to add tracks to this model")}function w(){switch(t){case 0:return!E;case 1:return!(A&&v&&(null==o?void 0:o.type)&&c);default:return!0}}return n.createElement("div",{className:r.root},n.createElement(m.A,{className:r.stepper,activeStep:t,orientation:"vertical"},Y.map(((l,s)=>n.createElement(p.A,{key:l},n.createElement(u.A,null,l),n.createElement(g.A,null,function(t){switch(t){case 0:return n.createElement(K,{model:e});case 1:return n.createElement($,{model:e});default:return n.createElement(d.A,null,"Unknown step")}}(s),n.createElement("div",{className:r.actionsContainer},n.createElement(k.A,{disabled:0===t,onClick:()=>{T(void 0),a(t-1)},className:r.button},"Back"),n.createElement(k.A,{disabled:w(),variant:"contained",color:"primary",onClick:x,className:r.button,"data-testid":"addTrackNextButton"},t===Y.length-1?"Add":"Next")),N?n.createElement("div",{className:r.alertContainer},n.createElement(f.A,{severity:"error"},N)):null))))))})),X=(0,E.makeStyles)()({textbox:{width:"100%"},submit:{marginTop:25,marginBottom:100,display:"block"}}),Z=(0,r.observer)((function({model:e}){const{classes:t}=X(),[a,r]=(0,n.useState)(""),[l,s]=(0,n.useState)();return n.createElement("div",null,l?n.createElement(T.ErrorMessage,{error:l}):null,n.createElement(v.A,{multiline:!0,rows:10,value:a,onChange:e=>r(e.target.value),placeholder:"Paste track config or array of track configs in JSON format",variant:"outlined",className:t.textbox}),n.createElement(k.A,{variant:"contained",className:t.submit,onClick:()=>{try{s(void 0);const t=(0,i.getSession)(e),n=JSON.parse(a),r=Array.isArray(n)?n:[n];(0,i.isSessionWithAddTracks)(t)&&(0,i.isSessionModelWithWidgets)(t)&&(r.forEach((e=>t.addTrackConf(e))),r.forEach((t=>e.view.showTrack(t.trackId))),e.clearData(),t.hideWidget(e))}catch(e){console.error(e),s(e)}}},"Submit"))})),ee=(0,r.observer)((function({model:e}){const[t,a]=(0,n.useState)("Default add track workflow"),{pluginManager:r}=(0,i.getEnv)(e),d=r.getAddTrackWorkflowElements(),m={"Default add track workflow":Q,"Add track JSON":Z,...Object.fromEntries(d.map((e=>[e.name,e.ReactComponent])))},p=m[t]?t:"Default add track workflow",u=m[p];return n.createElement(n.Fragment,null,n.createElement(l.A,null,n.createElement(s.A,{value:p,onChange:e=>a(e.target.value)},Object.keys(m).map((e=>n.createElement(c.A,{key:e,value:e},e)))),n.createElement(o.A,null,"Type of add track workflow")),n.createElement("br",null),n.createElement(u,{model:e}))}))},67034:(e,t,a)=>{var n=a(24994);t.A=void 0;var r=n(a(42032)),l=a(74848);t.A=(0,r.default)((0,l.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")}}]);